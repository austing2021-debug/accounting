<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é›²ç«¯è¨˜å¸³æœ¬</title>
    <style>
        :root { --primary: #4a90e2; --bg: #f5f7fa; --btn-bg: #ffffff; }
        body { font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 15px; margin: 0; }
        
        /* å®¹å™¨èˆ‡è‡ªé©æ‡‰å¯¬åº¦ */
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; box-sizing: border-box; }
        
        h2 { text-align: center; margin-top: 0; color: #333; font-size: 1.2rem; }
        .form-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; color: #666; font-size: 14px; font-weight: bold; }
        
        /* 1. ä¿®æ­£æ—¥æœŸèˆ‡è¼¸å…¥æ¡†å¯¬åº¦ï¼Œç¢ºä¿ä¸è¶…å‡ºç•«é¢ */
        input[type="date"], input[type="number"], input[type="text"], select { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            box-sizing: border-box; font-size: 16px; background: #fff; appearance: none;
        }

        /* 2. 8å€‹å¤§é¡åˆ¥æŒ‰éˆ• (4x2 æ’ç‰ˆ) */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 8px;
            margin-bottom: 15px;
        }
        .cat-btn {
            padding: 12px 0;
            background: var(--btn-bg);
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .cat-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            font-weight: bold;
            transform: scale(0.95);
        }

        /* 3. å­é …ç›®ä¸‹æ‹‰å€å¡Š - åˆå§‹éš±è— */
        #sub-category-container { display: none; background: #f0f7ff; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
        
        button#submitBtn { 
            width: 100%; padding: 15px; background: var(--primary); color: white; 
            border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer;
            margin-top: 10px; transition: 0.3s;
        }
        button#submitBtn:disabled { background: #ccc; }
        
        #status { margin-top: 15px; text-align: center; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸ’° é›²ç«¯å¿«é€Ÿè¨˜å¸³</h2>
        
        <div class="form-group">
            <label>ğŸ“… æ—¥æœŸ</label>
            <input type="date" id="date">
        </div>

        <div class="form-group">
            <label>ğŸ·ï¸ ä¸»é¡åˆ¥</label>
            <div class="category-grid" id="main-category">
                <div class="cat-btn" onclick="selectMainCat('é£Ÿ', this)">é£Ÿ</div>
                <div class="cat-btn" onclick="selectMainCat('è¡£', this)">è¡£</div>
                <div class="cat-btn" onclick="selectMainCat('ä½', this)">ä½</div>
                <div class="cat-btn" onclick="selectMainCat('è¡Œ', this)">è¡Œ</div>
                <div class="cat-btn" onclick="selectMainCat('è‚²', this)">è‚²</div>
                <div class="cat-btn" onclick="selectMainCat('æ¨‚', this)">æ¨‚</div>
                <div class="cat-btn" onclick="selectMainCat('é‡‘', this)">é‡‘</div>
                <div class="cat-btn" onclick="selectMainCat('é›œ', this)">é›œ</div>
            </div>
        </div>

        <div class="form-group" id="sub-category-container">
            <label>ğŸ” å­é …ç›®</label>
            <select id="sub-category"></select>
        </div>

        <div class="form-group">
            <label>ğŸ’µ é‡‘é¡</label>
            <input type="number" id="amount" placeholder="0" inputmode="decimal">
        </div>

        <div class="form-group">
            <label>ğŸ“ å‚™è¨»</label>
            <input type="text" id="note" placeholder="é¸å¡«...">
        </div>

        <button id="submitBtn" onclick="submitData()">ç¢ºèªé€å‡º</button>
        <div id="status"></div>
    </div>

    <script>
        // åˆå§‹åŒ–ï¼šé è¨­ä»Šå¤©æ—¥æœŸ
        document.getElementById('date').valueAsDate = new Date();

        let currentMainCat = "";

        // å®šç¾©å­é …ç›®è³‡æ–™åº«
        const subData = {
            "é£Ÿ": ["æ—©é¤", "ä¸­é¤", "æ™šé¤", "é»å¿ƒ", "èœéŒ¢"],
            "è¡£": ["ä¸Šè¡£", "è¤²å­", "å…§è¡£", "å…§è¤²", "è¥ªå­", "é…ä»¶"],
            "ä½": ["æ‰‹æ©Ÿè²»", "ç¶²è·¯è²»", "é›»è²»", "æ°´è²»", "ç“¦æ–¯è²»", "ç§Ÿè»Šä½è²»", "ç®¡ç†è²»", "ç¨…è²»"],
            "è¡Œ": ["æ²¹éŒ¢", "åœè»Šè²»", "ä½å®¿è²»", "ç§Ÿè»Šè²»", "äº¤é€šè²»", "ä¿®è»Šè²»"],
            "è‚²": ["å­¸è²»", "æ›¸è²»", "æ•™è‚²è²»", "AIè²»"],
            "æ¨‚": ["å¨›æ¨‚è²»", "é›»è¦–è²»", "æ•™è‚²è²»"],
            "é‡‘": ["å­˜æ¬¾", "è‚¡ç¥¨", "è™›æ“¬å¹£"],
            "é›œ": ["ä¿éšªè²»", "å…¶ä»–"]
        };

        // é¸æ“‡ä¸»é¡åˆ¥é‚è¼¯
        function selectMainCat(cat, btnElement) {
            currentMainCat = cat;
            
            // è¦–è¦ºæ•ˆæœï¼šåˆ‡æ› Active ç‹€æ…‹
            document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');

            // æ›´æ–°ä¸¦é¡¯ç¤ºå­é¡åˆ¥ä¸‹æ‹‰é¸å–®
            const container = document.getElementById('sub-category-container');
            const select = document.getElementById('sub-category');
            
            select.innerHTML = ""; 
            subData[cat].forEach(item => {
                let opt = document.createElement('option');
                opt.value = item;
                opt.innerHTML = item;
                select.appendChild(opt);
            });

            container.style.display = "block";
        }

        async function submitData() {
            // 1. å¯†ç¢¼é©—è­‰
            const pwd = prompt("è«‹è¼¸å…¥è¨˜å¸³å¯†ç¢¼ï¼š");
            if (pwd !== "0728") {
                alert("å¯†ç¢¼éŒ¯èª¤ï¼Œæ‹’çµ•å­˜å–ï¼");
                return;
            }

            // æ¬„ä½æª¢æŸ¥
            if (!currentMainCat) { alert("è«‹å…ˆé¸æ“‡ä¸»é¡åˆ¥"); return; }
            if (!document.getElementById('amount').value) { alert("è«‹è¼¸å…¥é‡‘é¡"); return; }

            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('status');
            
            // --- âš ï¸ è«‹å‹™å¿…ç¢ºèªä¸‹æ–¹ç¶²å€æ˜¯å¦æ­£ç¢º ---
            const url = "https://script.google.com/macros/s/AKfycbw_bob4WLfVlpah8dfXbeDpPgt_OplbfzknnWXe_A3RIOBKS22qzCcxagpmMMA9JXqn/exec";

            const payload = {
                date: document.getElementById('date').value,
                mainCategory: currentMainCat,
                subCategory: document.getElementById('sub-category').value,
                amount: document.getElementById('amount').value,
                note: document.getElementById('note').value
            };

            btn.disabled = true;
            status.style.color = "blue";
            status.innerText = "â³ æ­£åœ¨åŒæ­¥è‡³é›²ç«¯...";

            try {
                // ä½¿ç”¨ no-cors æ¨¡å¼ç™¼
