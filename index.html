<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å€‹äººè¨˜å¸³ç³»çµ±</title>
    <style>
        :root { --primary: #4a90e2; --bg: #f5f7fa; --btn-bg: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 15px; margin: 0; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; box-sizing: border-box; }
        
        h2 { text-align: center; margin-top: 0; color: #333; font-size: 1.2rem; }
        .form-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; color: #666; font-size: 14px; }
        
/* ç¢ºä¿æ—¥æœŸæ ¼å­åœ¨æ‰‹æ©Ÿä¸Šç¸®çŸ­ä¸”ä¸è¶…å‡º */
input[type="date"] {
    max-width: 100%; /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
    width: 100%;
    box-sizing: border-box; /* åŒ…å«å…§è·èˆ‡é‚Šæ¡† */
}

/* æŒ‰éˆ• 4x2 æ’ç‰ˆ */
.category-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); 
    gap: 5px; /* ç¸®å°é–“è·æ›´çœç©ºé–“ */
}
        .cat-btn {
            padding: 10px 0;
            background: var(--btn-bg);
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
        }
        .cat-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            font-weight: bold;
        }

        /* 3. ä¸‹æ‹‰å¼å€å¡Š */
        #sub-category-container { display: none; margin-bottom: 15px; }
        
        button#submitBtn { 
            width: 100%; padding: 15px; background: var(--primary); color: white; 
            border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        #status { margin-top: 15px; text-align: center; font-size: 14px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸ’° å¿«é€Ÿè¨˜å¸³</h2>
        
        <div class="form-group">
            <label>æ—¥æœŸ</label>
            <input type="date" id="date">
        </div>

        <div class="form-group">
            <label>ä¸»é¡åˆ¥</label>
            <div class="category-grid" id="main-category">
                <div class="cat-btn" onclick="selectMainCat('é£Ÿ', this)">é£Ÿ</div>
                <div class="cat-btn" onclick="selectMainCat('è¡£', this)">è¡£</div>
                <div class="cat-btn" onclick="selectMainCat('ä½', this)">ä½</div>
                <div class="cat-btn" onclick="selectMainCat('è¡Œ', this)">è¡Œ</div>
                <div class="cat-btn" onclick="selectMainCat('è‚²', this)">è‚²</div>
                <div class="cat-btn" onclick="selectMainCat('æ¨‚', this)">æ¨‚</div>
                <div class="cat-btn" onclick="selectMainCat('é‡‘', this)">é‡‘</div>
                <div class="cat-btn" onclick="selectMainCat('é›œ', this)">é›œ</div>
            </div>
        </div>

        <div class="form-group" id="sub-category-container">
            <label>å­é …ç›®</label>
            <select id="sub-category"></select>
        </div>

        <div class="form-group">
            <label>é‡‘é¡</label>
            <input type="number" id="amount" placeholder="è¼¸å…¥é‡‘é¡" inputmode="decimal">
        </div>

        <div class="form-group">
            <label>å‚™è¨»</label>
            <input type="text" id="note" placeholder="å‚™è¨»...">
        </div>

        <button id="submitBtn" onclick="submitData()">ç¢ºèªé€å‡º</button>
        <div id="status"></div>
    </div>

    <script>
        // è¨­å®šä»Šå¤©æ—¥æœŸ
        document.getElementById('date').valueAsDate = new Date();

        let currentMainCat = "";

        // å­é¡åˆ¥è³‡æ–™åº«
        const subData = {
            "é£Ÿ": ["æ—©é¤", "ä¸­é¤", "æ™šé¤", "é»å¿ƒ", "èœéŒ¢"],
            "è¡£": ["ä¸Šè¡£", "è¤²å­", "å…§è¡£", "å…§è¤²", "è¥ªå­", "é…ä»¶"],
            "ä½": ["æ‰‹æ©Ÿè²»", "ç¶²è·¯è²»", "é›»è²»", "æ°´è²»", "ç“¦æ–¯è²»", "ç§Ÿè»Šä½è²»", "ç®¡ç†è²»", "ç¨…è²»"],
            "è¡Œ": ["æ²¹éŒ¢", "åœè»Šè²»", "ä½å®¿è²»", "ç§Ÿè»Šè²»", "äº¤é€šè²»", "ä¿®è»Šè²»"],
            "è‚²": ["å­¸è²»", "æ›¸è²»", "æ•™è‚²è²»", "AIè²»"],
            "æ¨‚": ["å¨›æ¨‚è²»", "é›»è¦–è²»", "æ•™è‚²è²»"],
            "é‡‘": ["å­˜æ¬¾", "è‚¡ç¥¨", "è™›æ“¬å¹£"],
            "é›œ": ["ä¿éšªè²»", "å…¶ä»–"]
        };

        // é¸æ“‡ä¸»é¡åˆ¥çš„å‹•ä½œ
        function selectMainCat(cat, btnElement) {
            currentMainCat = cat;
            
            // è®Šæ›´æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');

            // é¡¯ç¤ºå­é¡åˆ¥ä¸‹æ‹‰é¸å–®
            const container = document.getElementById('sub-category-container');
            const select = document.getElementById('sub-category');
            
            select.innerHTML = ""; // æ¸…ç©ºèˆŠé¸é …
            subData[cat].forEach(item => {
                let opt = document.createElement('option');
                opt.value = item;
                opt.innerHTML = item;
                select.appendChild(opt);
            });

            container.style.display = "block";
        }

        async function submitData() {
            // 1. é©—è­‰å¯†ç¢¼
            const pwd = prompt("è«‹è¼¸å…¥è¨˜å¸³å¯†ç¢¼ï¼š");
            if (pwd !== "0728") {
                alert("å¯†ç¢¼éŒ¯èª¤ï¼");
                return;
            }

            if (!currentMainCat) { alert("è«‹é¸æ“‡ä¸€å€‹é¡åˆ¥"); return; }
            if (!document.getElementById('amount').value) { alert("è«‹è¼¸å…¥é‡‘é¡"); return; }

            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('status');
            const url = "https://script.google.com/macros/s/AKfycbw_bob4WLfVlpah8dfXbeDpPgt_OplbfzknnWXe_A3RIOBKS22qzCcxagpmMMA9JXqn/exec"; // <--- è¨˜å¾—æª¢æŸ¥é€™è¡Œ

            const payload = {
                date: document.getElementById('date').value,
                category: `${currentMainCat} - ${document.getElementById('sub-category').value}`, // åˆä½µå¤§é¡èˆ‡å°é¡
                amount: document.getElementById('amount').value,
                note: document.getElementById('note').value
            };

            btn.disabled = true;
            status.innerText = "â³ å‚³é€ä¸­...";

            try {
                await fetch(url, {
                    method: "POST",
                    mode: "no-cors",
                    body: JSON.stringify(payload),
                    headers: { "Content-Type": "text/plain" }
                });
                status.style.color = "green";
                status.innerText = "âœ… è¨˜å¸³æˆåŠŸï¼";
                document.getElementById('amount').value = "";
                document.getElementById('note').value = "";
            } catch (error) {
                status.innerText = "âŒ å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯";
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
